<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Graahi – Faculty Attendance</title>
    <!-- instead of CDN -->
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->

    <!-- use Flask static path -->
    <script src="{{ url_for('static', filename='js/tailwindcss.js') }}"></script>

    <script>
        // Tailwind config for gradient/brand colors
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#eef2ff', 100: '#e0e7ff', 600: '#4338ca', 700: '#3730a3'
                        }
                    }
                }
            }
        }
    </script>
    <!-- Export libraries -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>

<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100">
    <header class="bg-white/90 backdrop-blur border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row md:items-center md:gap-4 gap-3">
            <div class="flex md:block items-center justify-center">
                <img src="{{ url_for('static', filename='images/logo-removebg-preview.png') }}" alt="College Logo"
                    class="h-16 w-16 md:h-20 md:w-20 object-contain" />
            </div>
            <div class="min-w-0 text-center md:text-left">
                <h1 class="text-2xl md:text-3xl font-bold text-slate-900 leading-tight md:truncate">Dr. B. B. Hegde
                    First Grade College, Kundapura</h1>
                <div class="h-0.5 bg-slate-200 my-1 mx-auto md:mx-0 w-11/12 md:w-full"></div>
                <p class="text-xs sm:text-sm text-slate-600">A Unit of Coondapur Education Society (R)</p>
            </div>
            <div class="ml-auto flex justify-end w-full md:w-auto mt-2 md:mt-0 self-end">
                <div class="flex items-end gap-4 text-xs sm:text-sm">
                    <span class="text-slate-600 hidden sm:inline">Welcome, admin</span>
                    <a href="{{ url_for('logout') }}" class="text-rose-600 hover:text-rose-700 font-medium">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 mt-8">
        <section class="text-center">
            <h2
                class="text-4xl sm:text-5xl font-extrabold bg-gradient-to-r from-brand-700 to-indigo-500 bg-clip-text text-transparent">
                Graahi</h2>
            <p class="mt-2 text-base sm:text-lg text-slate-600 font-bold">YOUR PRESENCE, OUR PRIORITY</p>
        </section>

        <section class="mt-8 bg-white border border-slate-200 rounded-xl shadow-sm">
            <div class="px-4 sm:px-6 py-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-6 h-6 text-brand-700">
                        <path
                            d="M6.75 3A3.75 3.75 0 0 0 3 6.75v10.5A3.75 3.75 0 0 0 6.75 21h10.5A3.75 3.75 0 0 0 21 17.25V6.75A3.75 3.75 0 0 0 17.25 3H6.75zM8.25 7.5a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75zM7.5 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5H8.25A.75.75 0 0 1 7.5 12zm.75 3.75a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5H8.25z" />
                    </svg>
                    <h3 class="text-lg font-semibold text-slate-900">Faculty Check‑in / Check‑out</h3>
                </div>
                <div class="flex items-center gap-3">
                    <label for="datePicker" class="text-sm text-slate-600">Select date</label>
                    <input id="datePicker" type="date"
                        class="px-3 py-2 rounded-md border border-slate-300 text-slate-700 focus:outline-none focus:ring-2 focus:ring-brand-600 focus:border-brand-600" />
                    <button id="refreshBtn"
                        class="inline-flex items-center gap-2 px-3 sm:px-4 py-2 rounded-md bg-gradient-to-r from-brand-700 to-indigo-600 text-white shadow hover:opacity-95"
                        aria-label="Refresh" title="Refresh">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path
                                d="M12 6v3l-4-4 4-4v3a8 8 0 1 1-7.446 4.97.75.75 0 1 1 1.392-.56A6.5 6.5 0 1 0 12 6z" />
                        </svg>
                        <span class="hidden sm:inline">Refresh</span>
                    </button>
                </div>
            </div>
            <!-- Search bar positioned directly under the section title -->
            <div class="px-4 sm:px-6 pb-2">
                <div class="max-w-xl">
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-500">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" class="w-5 h-5">
                                <circle cx="11" cy="11" r="7" />
                                <path d="M21 21l-3.6-3.6" />
                            </svg>
                        </span>
                        <input id="searchInput" type="text" placeholder="Search by Faculty ID, Name, or time..."
                            class="w-full pl-9 pr-3 py-2 rounded-md border border-slate-300 text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-600 focus:border-brand-600" />
                    </div>
                </div>
            </div>
            <div class="px-4 sm:px-6 pb-6">
                <div class="mb-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                    <div class="text-sm text-slate-600">Showing data for <span id="selectedDateLabel"
                            class="font-medium text-slate-900"></span></div>
                    <div class="flex items-center gap-2 sm:justify-end">
                        <button id="exportExcelBtn"
                            class="inline-flex items-center gap-2 px-3 sm:px-4 py-2 rounded-md bg-emerald-600 text-white shadow hover:opacity-95">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                class="w-5 h-5">
                                <path
                                    d="M4.5 3A1.5 1.5 0 0 0 3 4.5v15A1.5 1.5 0 0 0 4.5 21h15a1.5 1.5 0 0 0 1.5-1.5v-15A1.5 1.5 0 0 0 19.5 3h-15zm3.28 4.47 2.47 3.53 2.47-3.53h2.06l-3.28 4.67 3.28 4.66h-2.06l-2.47-3.52-2.47 3.52H5.72l3.28-4.66L5.72 7.47h2.06z" />
                            </svg>
                            Export Excel
                        </button>
                        <button id="exportPdfBtn"
                            class="inline-flex items-center gap-2 px-3 sm:px-4 py-2 rounded-md bg-rose-600 text-white shadow hover:opacity-95">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                class="w-5 h-5">
                                <path
                                    d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h7l5-5V4a2 2 0 0 0-2-2H6zm9 14h4l-4 4v-4zM7 6h10v2H7V6zm0 4h10v2H7v-2zm0 4h6v2H7v-2z" />
                            </svg>
                            Export PDF
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto rounded-lg border border-slate-200">
                    <table id="attendanceTable" class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700 whitespace-nowrap">
                                    Faculty ID</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">Name</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700 whitespace-nowrap">
                                    Check‑in (Time)</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700 whitespace-nowrap">
                                    Check‑out (Time)</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700 whitespace-nowrap">
                                    Delay (Time)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100 bg-white">
                            <tr>
                                <td colspan="5" class="px-4 py-6 text-center text-slate-500">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            <div class="mt-3 text-xs sm:text-sm text-slate-700">
                <div class="inline-flex items-center gap-2 mr-4"><span class="inline-block h-3 w-3 rounded-sm bg-emerald-100 border border-emerald-300"></span><span>Delay ≤ 01:00:00 (OK)</span></div>
                <div class="inline-flex items-center gap-2 mr-4"><span class="inline-block h-3 w-3 rounded-sm bg-amber-100 border border-amber-300"></span><span>01:00:01 – 02:00:00 (Half‑day)</span></div>
                <div class="inline-flex items-center gap-2 mr-4"><span class="inline-block h-3 w-3 rounded-sm bg-rose-100 border border-rose-300"></span><span>≥ 02:00:01 (Full‑day)</span></div>
                <div class="inline-flex items-center gap-2"><span class="inline-block h-3 w-3 rounded-sm bg-purple-100 border border-purple-300"></span><span>Absent (N/A)</span></div>
            </div>
            </div>
        </section>
    </main>

    <footer class="mt-10">
        <div class="h-px bg-gradient-to-r from-transparent via-indigo-300 to-transparent"></div>
        <div class="max-w-7xl mx-auto px-4">
            <div class="py-6 text-center text-xs sm:text-sm text-slate-600">
                © 2025 Moulya | Developed by Incubation Center | All Rights Reserved.
            </div>
        </div>
    </footer>

    <script>
        const datePicker = document.getElementById('datePicker');
        const selectedDateLabel = document.getElementById('selectedDateLabel');
        const tableBody = document.querySelector('#attendanceTable tbody');
        const refreshBtn = document.getElementById('refreshBtn');
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const exportPdfBtn = document.getElementById('exportPdfBtn');
        const searchInput = document.getElementById('searchInput');

        // Local cache for faster client-side filtering
        let cachedRows = [];

        function formatYMD(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function setSelectedDateLabel(ymd) {
            selectedDateLabel.textContent = ymd;
        }

        function toReadable(ts) {
            if (!ts) return '';
            const d = new Date(ts);
            if (isNaN(d.getTime())) return ts; // fallback to original if unparsable
            const dd = String(d.getDate()).padStart(2, '0');
            const mm = String(d.getMonth() + 1).padStart(2, '0');
            const yyyy = d.getFullYear();
            const hh = String(d.getHours()).padStart(2, '0');
            const mi = String(d.getMinutes()).padStart(2, '0');
            const ss = String(d.getSeconds()).padStart(2, '0');
            return `${dd}-${mm}-${yyyy} ${hh}:${mi}:${ss}`;
        }

        function toTimeOnly(ts) {
            if (!ts) return '';
            const d = new Date(ts);
            if (isNaN(d.getTime())) return ts; // fallback to original if unparsable
            const hh = String(d.getHours()).padStart(2, '0');
            const mi = String(d.getMinutes()).padStart(2, '0');
            const ss = String(d.getSeconds()).padStart(2, '0');
            return `${hh}:${mi}:${ss}`;
        }

        async function loadAttendance(ymd) {
            setSelectedDateLabel(ymd);
            tableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray">Loading...</td></tr>';
            try {
                const res = await fetch(`/api/attendance?date=${encodeURIComponent(ymd)}`);
                if (!res.ok) throw new Error('Failed to fetch attendance');
                let rows = await res.json();
                if (Array.isArray(rows)) {
                    rows = rows.slice().sort((a, b) => {
                        const aId = (a.student_id || '').toString();
                        const bId = (b.student_id || '').toString();
                        return aId.localeCompare(bId, undefined, { numeric: true, sensitivity: 'base' });
                    });
                }
                cachedRows = rows;
                if (!Array.isArray(rows) || rows.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray">No records</td></tr>';
                    return;
                }
                renderTable(rows);
            } catch (err) {
                tableBody.innerHTML = `<tr><td colspan="5" class="text-center" style="color:#b91c1c">${err.message}</td></tr>`;
            }
        }

        function hmsToSeconds(hms) {
            if (!hms || typeof hms !== 'string') return 0;
            const parts = hms.split(':');
            if (parts.length !== 3) return 0;
            const [hh, mm, ss] = parts.map(x => parseInt(x, 10) || 0);
            return (hh * 3600) + (mm * 60) + ss;
        }

        function classifyDelayColor(delayVal) {
            if (!delayVal || typeof delayVal !== 'string') return '';
            if (delayVal.toUpperCase() === 'N/A') return 'bg-purple-50';
            const s = hmsToSeconds(delayVal);
            if (s === 0) return 'bg-emerald-50';
            if (s <= 3600) return 'bg-emerald-50';
            if (s <= 7200) return 'bg-amber-50';
            return 'bg-rose-50';
        }

        function renderTable(rows) {
            tableBody.innerHTML = '';
            // Group by student_id to rowspan delay per person
            const groups = {};
            for (const r of rows) {
                const key = (r.student_id || '').toString();
                if (!groups[key]) groups[key] = [];
                groups[key].push(r);
            }
            Object.values(groups).forEach(group => {
                const groupDelayVal = (group[0]?.delay ?? '').toString();
                const rowColorClass = classifyDelayColor(groupDelayVal);
                group.forEach((r, idx) => {
                    const tr = document.createElement('tr');
                    if (rowColorClass) tr.className = rowColorClass;
                    const tdId = document.createElement('td');
                    const tdName = document.createElement('td');
                    const tdIn = document.createElement('td');
                    const tdOut = document.createElement('td');
                    tdId.className = 'px-4 py-3 whitespace-nowrap text-slate-800';
                    tdName.className = 'px-4 py-3 break-words text-slate-800';
                    tdIn.className = 'px-4 py-3 whitespace-nowrap text-slate-800';
                    tdOut.className = 'px-4 py-3 whitespace-nowrap text-slate-800';
                    tdId.textContent = r.student_id || '';
                    tdName.textContent = r.name || '';
                    tdIn.textContent = toTimeOnly(r.checkin);
                    tdOut.textContent = toTimeOnly(r.checkout);
                    tr.appendChild(tdId);
                    tr.appendChild(tdName);
                    tr.appendChild(tdIn);
                    tr.appendChild(tdOut);
                    if (idx === 0) {
                        const tdDelay = document.createElement('td');
                        const delayVal = (r.delay ?? '').toString();
                        if (delayVal.toUpperCase() === 'N/A') {
                            tdDelay.textContent = 'Absent';
                            tdDelay.className = 'px-4 py-3 whitespace-nowrap font-semibold text-rose-600';
                        } else {
                            tdDelay.textContent = delayVal;
                            tdDelay.className = 'px-4 py-3 whitespace-nowrap text-slate-800';
                        }
                        tdDelay.rowSpan = group.length;
                        tr.appendChild(tdDelay);
                    }
                    tableBody.appendChild(tr);
                });
            });
        }

        // initialize with current date
        const todayYmd = formatYMD(new Date());
        datePicker.value = todayYmd;
        loadAttendance(todayYmd);

        datePicker.addEventListener('change', () => loadAttendance(datePicker.value));
        refreshBtn.addEventListener('click', () => loadAttendance(datePicker.value));

        // Real-time client-side filtering
        function applyFilter() {
            const q = (searchInput.value || '').toLowerCase().trim();
            if (!q) { renderTable(cachedRows); return; }
            const filtered = (cachedRows || []).filter(r => {
                const id = (r.student_id || '').toString().toLowerCase();
                const name = (r.name || '').toLowerCase();
                // Exclude check-in/check-out from matching per request
                return id.includes(q) || name.includes(q);
            });
            renderTable(filtered);
        }
        if (searchInput) searchInput.addEventListener('input', applyFilter);



        function exportTableToExcel() {
            const table = document.getElementById('attendanceTable');
            const workbook = new ExcelJS.Workbook();
            const sheet = workbook.addWorksheet('Attendance');

            // Read headers
            const headerCells = Array.from(table.querySelectorAll('thead th')).map(th => th.innerText.trim());
            const numCols = headerCells.length;

            // Title row (centered across all columns)
            const titleText = 'Faculty Attendance Report';
            const titleRow = sheet.addRow([titleText]);
            sheet.mergeCells(1, 1, 1, numCols);
            titleRow.getCell(1).font = { bold: true, size: 16, color: { argb: 'FF000000' } };
            titleRow.getCell(1).alignment = { horizontal: 'center', vertical: 'middle' };
            titleRow.height = 24;

            // Date row (DD-MM-YYYY) under the title
            const ymd = datePicker.value || '';
            const parts = (ymd || '').split('-');
            const prettyDate = parts.length === 3 ? `${parts[2]}-${parts[1]}-${parts[0]}` : ymd;
            const dateRow = sheet.addRow([`Date: ${prettyDate}`]);
            sheet.mergeCells(2, 1, 2, numCols);
            dateRow.getCell(1).font = { bold: true, size: 12, color: { argb: 'FF000000' } };
            dateRow.getCell(1).alignment = { horizontal: 'center', vertical: 'middle' };
            dateRow.height = 18;

            // Header row (black background, bold white text)
            sheet.addRow(headerCells);
            const headerRow = sheet.getRow(3);
            headerRow.font = { bold: true, color: { argb: 'FFFFFFFF' } };
            headerRow.alignment = { vertical: 'middle', horizontal: 'left' };
            headerRow.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF000000' } }; // black
            headerRow.height = 22;

            // Add body rows
            const bodyRows = Array.from(table.querySelectorAll('tbody tr'));
            bodyRows.forEach(tr => {
                const cells = Array.from(tr.querySelectorAll('td')).map(td => td.innerText.trim());
                sheet.addRow(cells);
            });

            // Add thin borders and wrap text for all cells to retain readable GUI-like format
            sheet.eachRow(row => {
                row.eachCell(cell => {
                    cell.border = {
                        top: { style: 'thin', color: { argb: 'FFCBD5E1' } },
                        left: { style: 'thin', color: { argb: 'FFCBD5E1' } },
                        bottom: { style: 'thin', color: { argb: 'FFCBD5E1' } },
                        right: { style: 'thin', color: { argb: 'FFCBD5E1' } },
                    };
                    if (!cell.alignment) cell.alignment = {};
                    cell.alignment.wrapText = true;
                    cell.alignment.vertical = 'middle';
                });
            });

            // Dynamic column widths based on longest cell in each column
            for (let i = 1; i <= numCols; i++) {
                let maxLen = headerCells[i - 1]?.length || 10;
                sheet.getColumn(i).eachCell({ includeEmpty: true }, cell => {
                    const v = (cell.value ?? '').toString();
                    if (v.length > maxLen) maxLen = v.length;
                });
                // Add padding; approximate Excel width
                sheet.getColumn(i).width = Math.min(Math.max(maxLen + 2, 10), 60);
            }

            const fileDate = datePicker.value || 'attendance';
            workbook.xlsx.writeBuffer().then(buffer => {
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `attendance_${fileDate}.xlsx`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        async function exportTableToPdf() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });

                // Sanitize helper to avoid PDF header garbling
                const sanitize = (text) => {
                    if (!text) return '';
                    return text
                        .replace(/[\u200B-\u200D\uFEFF]/g, '')
                        .replace(/[\u2010\u2011\u2012\u2013\u2014\u2212]/g, '-')
                        .replace(/\s+/g, ' ')
                        .trim();
                };

                const logoUrl = "{{ url_for('static', filename='images/logo-removebg-preview.png') }}";
                async function loadImageAsDataUrl(url) {
                    try {
                        const res = await fetch(url);
                        const blob = await res.blob();
                        return await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.readAsDataURL(blob);
                        });
                    } catch (e) { return null; }
                }

                // Header layout
                const marginX = 40;
                const topY = 40;
                let currentY = topY;
                const logoDataUrl = await loadImageAsDataUrl(logoUrl);
                const logoHeight = 48;
                let logoWidth = 72; // fallback conservative width
                if (logoDataUrl) {
                    try {
                        // Compute width preserving aspect
                        await new Promise((resolve) => {
                            const img = new Image();
                            img.onload = () => {
                                const ratio = img.naturalWidth / img.naturalHeight || 1.5;
                                logoWidth = Math.round(logoHeight * ratio);
                                resolve();
                            };
                            img.src = logoDataUrl;
                        });
                        doc.addImage(logoDataUrl, 'PNG', marginX, currentY, logoWidth, logoHeight);
                    } catch (_) { /* ignore logo rendering errors */ }
                }
                const textX = marginX + logoWidth + 16;
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Dr. B. B. Hegde First Grade College, Kundapura', textX, currentY + 22);
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text('A Unit of Coondapur Education Society (R)', textX, currentY + 40);

                // Divider line
                doc.setDrawColor(203, 213, 225);
                doc.setLineWidth(1);
                doc.line(marginX, currentY + logoHeight + 12, doc.internal.pageSize.getWidth() - marginX, currentY + logoHeight + 12);

                // Section title and date
                const sectionY = currentY + logoHeight + 36;
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Faculty Attendance', marginX, sectionY);
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                const parts = (datePicker.value || '').split('-');
                const prettyDate = parts.length === 3 ? `${parts[2]}-${parts[1]}-${parts[0]}` : datePicker.value;
                doc.text(`Date: ${prettyDate}`, marginX, sectionY + 18);

                // Table
                const table = document.getElementById('attendanceTable');
                const head = [Array.from(table.querySelectorAll('thead th')).map(th => sanitize(th.innerText))];
                const body = Array.from(table.querySelectorAll('tbody tr')).map(tr => Array.from(tr.querySelectorAll('td')).map(td => sanitize(td.innerText) || ''));
                doc.autoTable({
                    head,
                    body,
                    startY: sectionY + 30,
                    theme: 'grid',
                    styles: { fontSize: 9, cellPadding: 3, overflow: 'linebreak', lineColor: [0,0,0], lineWidth: 0.5 },
                    // Make header grid lines visible with white vertical separators on black background
                    headStyles: { fillColor: [0, 0, 0], textColor: 255, halign: 'left', lineColor: [255,255,255], lineWidth: 1 },
                    tableWidth: 'auto',
                    columnStyles: {},
                });

                doc.save(`attendance_${datePicker.value}.pdf`);
            } catch (e) {
                alert('Failed to generate PDF. Please try again.');
                console.error('PDF export error:', e);
            }
        }

        if (exportExcelBtn) exportExcelBtn.addEventListener('click', exportTableToExcel);
        if (exportPdfBtn) exportPdfBtn.addEventListener('click', exportTableToPdf);
    </script>
</body>

</html>